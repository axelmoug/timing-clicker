<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üéØ –ü–æ–ø–∞–¥–∏ –≤ –∑–µ–ª—ë–Ω—É—é –∑–æ–Ω—É!</title>

    <!-- üîπ –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø Embedded SVG –∏–∫–æ–Ω–∫–∞ (512x512) -->
    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTIiIGhlaWdodD0iNTIiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8Y2lyY2xlIGN4PSIyNTYiIGN5PSIyNTYiIHI9IjI0MCIgZmlsbD0iIzFFMUEyRSIgc3Ryb2tlPSIjNENDOUYwIiBzdHJva2Utd2lkdGg9IjE2Ii8+CjxjaXJjbGUgY3g9IjI1NiIgY3k9IjI1NiIgcj0iODAiIGZpbGw9IiM0Q0FGNTAiIHN0cm9rZT0ibm9uZSIvPgo8bGluZSB4MT0iMjU2IiB5MT0iMjU2IiB4Mj0iMjU2IiB5Mj0iMTAwIiBzdHJva2U9IiNGRkQ3MDAiIHN0cm9rZS13aWR0aD0iOCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+Cjx0ZXh0IHg9IjI1NiIgeT0iNDgwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iNDAiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmZmIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7QnNC10Lsg0KI8L3RleHQ+Cjwvc3ZnPg==">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a2e;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: white;
            padding: 10px;
        }

        .container {
            text-align: center;
            max-width: 90vw;
            width: 450px;
        }

        h1 {
            margin: 15px 0 20px;
            font-size: 28px;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }

        #difficulty {
            margin: 15px 0;
        }

        .diff-btn {
            padding: 8px 14px;
            margin: 0 4px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
            transition: background 0.2s;
        }

        .diff-btn:hover {
            background: #3a56d4;
        }

        .diff-btn.active {
            background: #ff6b6b;
        }

        #score {
            font-size: 20px;
            margin: 10px 0;
            font-weight: bold;
        }

        #gameCanvas {
            border: 2px solid #4cc9f0;
            border-radius: 50%;
            background: #16213e;
            margin: 15px auto;
            display: block;
        }

        button {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 16px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            transition: background 0.2s;
        }

        button:hover:not(:disabled) {
            background: #3a56d4;
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        #message {
            margin-top: 15px;
            font-size: 18px;
            min-height: 24px;
            line-height: 1.4;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéØ –ü–æ–ø–∞–¥–∏ –≤ –∑–µ–ª—ë–Ω—É—é –∑–æ–Ω—É!</h1>

        <div id="difficulty">
            <button class="diff-btn active" data-level="easy">–õ—ë–≥–∫–∏–π</button>
            <button class="diff-btn" data-level="medium">–°—Ä–µ–¥–Ω–∏–π</button>
            <button class="diff-btn" data-level="hard">–°–ª–æ–∂–Ω—ã–π</button>
        </div>

        <div id="score">–û—á–∫–∏: <span>0</span></div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>

        <button id="clickBtn">–ù–ê–ñ–ú–ò!</button>
        <button id="adBtn" style="display:none;">–°–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∫–ª–∞–º—É –∑–∞ +1 –ø–æ–ø—ã—Ç–∫—É</button>
        <button id="shareBtn" style="display:none;">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º</button>
        <button id="leaderboardBtn">üèÜ –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤</button>

        <div id="message"></div>
    </div>

    <!-- Yandex Games SDK -->
    <script src="https://yandex.ru/games/sdk/v2"></script>

    <script>
        // ============ –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ============
        let yandexSDK = null;
        let isYandexEnv = false;
        let currentDifficulty = 'easy';

        // –ú–µ–º–Ω—ã–µ —Ñ—Ä–∞–∑—ã
        const successPhrases = ['–£—Ä–∞!', '–ö—Ä–∞—Å–∞–≤–∞!', '–¢–æ—á–Ω–æ!'];
        const failPhrases = ['–≠—Ö...', '–ú–∏–º–æ!', '–û–π-–æ–π!'];

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–∏–∑–Ω–µ—Å–µ–Ω–∏—è —Ñ—Ä–∞–∑—ã
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ru-RU';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                speechSynthesis.speak(utterance);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Yandex SDK
        YaGames.init().then(ysdk => {
            yandexSDK = ysdk;
            isYandexEnv = true;
            console.log('Yandex SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
            ysdk.features.LoadingAPI?.ready();
        }).catch(err => {
            console.warn('Yandex SDK –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫)', err);
        });

        // ============ –ù–ê–°–¢–†–û–ô–ö–ò –°–õ–û–ñ–ù–û–°–¢–ò ============
        const difficultySettings = {
            easy: { speed: 0.03, attempts: 5 },
            medium: { speed: 0.05, attempts: 3 },
            hard: { speed: 0.08, attempts: 2 }
        };

        // ============ –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ============
        let score = 0;
        let attempts = 5;
        let isRunning = false;
        let angle = 0;
        let speed = 0.03;

        // ============ –≠–õ–ï–ú–ï–ù–¢–´ ============
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.querySelector('#score span');
        const messageEl = document.getElementById('message');
        const clickBtn = document.getElementById('clickBtn');
        const adBtn = document.getElementById('adBtn');
        const shareBtn = document.getElementById('shareBtn');
        const leaderboardBtn = document.getElementById('leaderboardBtn');

        // ============ –í–´–ë–û–† –°–õ–û–ñ–ù–û–°–¢–ò ============
        document.querySelectorAll('.diff-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.level;
                resetGame();
            });
        });

        // ============ –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ============
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 180;

            // –ó–µ–ª—ë–Ω–∞—è –∑–æ–Ω–∞
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, -Math.PI / 6, Math.PI / 6);
            ctx.strokeStyle = '#4CAF50';
            ctx.lineWidth = 30;
            ctx.stroke();

            // –°—Ç—Ä–µ–ª–∫–∞
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(angle);
            ctx.strokeStyle = '#FFD700';
            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.moveTo(-10, 0);
            ctx.lineTo(radius - 20, 0);
            ctx.stroke();
            ctx.restore();

            angle += speed;
            if (angle > Math.PI * 2) angle -= Math.PI * 2;
        }

        function update() {
            if (!isRunning) return;
            draw();
            requestAnimationFrame(update);
        }

        function getRandomPhrase(phrases) {
            return phrases[Math.floor(Math.random() * phrases.length)];
        }

        function checkHit() {
            let normalized = angle;
            if (normalized > Math.PI) normalized -= 2 * Math.PI;
            if (normalized < -Math.PI) normalized += 2 * Math.PI;

            if (normalized >= -Math.PI / 6 && normalized <= Math.PI / 6) {
                const accuracy = 1 - Math.abs(normalized) / (Math.PI / 6);
                const points = Math.max(10, Math.floor(accuracy * 100));
                score += points;
                scoreEl.textContent = score;

                const phrase = getRandomPhrase(successPhrases);
                messageEl.innerHTML = `‚úÖ ${phrase}<br>+${points} –æ—á–∫–æ–≤`;
                speak(phrase);

                setTimeout(() => messageEl.textContent = '', 1500);
            } else {
                attempts--;
                const phrase = getRandomPhrase(failPhrases);
                messageEl.innerHTML = `‚ùå ${phrase}`;
                speak(phrase);

                if (attempts <= 0) {
                    endGame();
                } else {
                    showAdButton();
                }
            }
        }

        function resetGame() {
            const settings = difficultySettings[currentDifficulty];
            speed = settings.speed;
            attempts = settings.attempts;
            score = 0;
            isRunning = false;
            angle = 0;
            scoreEl.textContent = score;
            clickBtn.disabled = false;
            clickBtn.textContent = '–ù–ê–ñ–ú–ò!';
            clickBtn.onclick = startRound;
            adBtn.style.display = 'none';
            shareBtn.style.display = 'none';
            messageEl.textContent = '';
        }

        function startRound() {
            isRunning = true;
            update();
            messageEl.textContent = '–ñ–¥–∏ –∑–µ–ª—ë–Ω—É—é –∑–æ–Ω—É...';
            setTimeout(() => {
                clickBtn.textContent = '–°–¢–û–ü!';
                clickBtn.onclick = checkHit;
            }, 2000);
        }

        function endGame() {
            isRunning = false;
            messageEl.innerHTML = `<b>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!<br>–í–∞—à —Å—á—ë—Ç: ${score}</b>`;
            clickBtn.disabled = true;
            adBtn.style.display = 'inline-block';
            shareBtn.style.display = 'inline-block';

            saveScoreToLeaderboard();
        }

        // ============ –†–ï–ö–õ–ê–ú–ê ============
        async function showRewardedAd() {
            if (!isYandexEnv || !yandexSDK) {
                alert('–†–ï–ö–õ–ê–ú–ê: +1 –ø–æ–ø—ã—Ç–∫—É (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)');
                return true;
            }
            try {
                await yandexSDK.adv.showRewardedVideo();
                return true;
            } catch (error) {
                alert('–†–µ–∫–ª–∞–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
                return false;
            }
        }

        // ============ –õ–ò–î–ï–†–ë–û–†–î ============
        async function saveScoreToLeaderboard() {
            if (!isYandexEnv || !yandexSDK) return;
            try {
                await yandexSDK.getLeaderboards().setScore('global_score', score);
                await yandexSDK.getLeaderboards().setScore('friends_score', score);
            } catch (e) {
                console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥:', e);
            }
        }

        async function showLeaderboard() {
            if (!isYandexEnv || !yandexSDK) {
                alert('–õ–∏–¥–µ—Ä–±–æ—Ä–¥ –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –≤ –Ø–Ω–¥–µ–∫—Å.–ò–≥—Ä–∞—Ö!');
                return;
            }
            try {
                await yandexSDK.getLeaderboards().show('global_score');
            } catch (e) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∫–æ—Ä–¥–æ–≤.');
            }
        }

        // ============ –ü–û–î–ï–õ–ò–¢–¨–°–Ø ============
        async function shareResult() {
            if (!isYandexEnv || !yandexSDK) {
                const msg = `–ú–æ–π —Å—á—ë—Ç: ${score}! –°—ã–≥—Ä–∞–π —Å–∞–º: https://axelmoug.github.io/timing-clicker/`;
                alert(msg);
                return;
            }
            try {
                await yandexSDK.share({
                    text: `–Ø –Ω–∞–±—Ä–∞–ª ${score} –æ—á–∫–æ–≤ –≤ –∏–≥—Ä–µ "–ü–æ–ø–∞–¥–∏ –≤ –∑–µ–ª—ë–Ω—É—é –∑–æ–Ω—É!"!`,
                    url: 'https://axelmoug.github.io/timing-clicker/'
                });
            } catch (e) {
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è.');
            }
        }

        // ============ –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ============
        clickBtn.addEventListener('click', startRound);

        adBtn.addEventListener('click', async () => {
            adBtn.disabled = true;
            const success = await showRewardedAd();
            if (success) {
                attempts = 1;
                isRunning = false;
                clickBtn.disabled = false;
                clickBtn.textContent = '–ù–ê–ñ–ú–ò!';
                clickBtn.onclick = startRound;
                messageEl.textContent = '‚ù§Ô∏è +1 –ø–æ–ø—ã—Ç–∫–∞!';
                adBtn.style.display = 'none';
            }
            adBtn.disabled = false;
        });

        shareBtn.addEventListener('click', shareResult);
        leaderboardBtn.addEventListener('click', showLeaderboard);

        // –°—Ç–∞—Ä—Ç
        resetGame();
    </script>
</body>

</html>